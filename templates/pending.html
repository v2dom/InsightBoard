{% extends "base_with_sidebar.html" %}

{% block title %}Admin Queue{% endblock %}

{% block content %}
<h1 class="text-3xl font-bold text-gray-900 mb-8">Admin Queue</h1>

<h2 class="text-xl font-semibold text-gray-800 mb-4">Pending Posts</h2>
{% for p in pending_posts %}
  <div class="card">
    <div class="text-sm text-gray-600 mb-1">
      {{ p.category }}
    </div>

    <div class="text-sm text-gray-500 mb-3">
      <span data-timestamp="{{ p.submitted_at.isoformat() }}" data-time-format="full"></span>
    </div>

    <p class="text-gray-800 mb-3">{{ p.content }}</p>

    <div class="flex space-x-3">
      <form method="POST" action="{{ url_for('routes.approve_post', pid=p.id) }}" style="display: inline;">
        <button type="submit" class="btn btn-success" style="padding: 6px 12px; font-size: 14px;">
          Approve
        </button>
      </form>
      <form method="POST" action="{{ url_for('routes.decline_post', pid=p.id) }}" style="display: inline;">
        <button type="submit" class="btn btn-danger" style="padding: 6px 12px; font-size: 14px;">
          Decline
        </button>
      </form>
    </div>
  </div>
{% else %}
  <p class="text-gray-500">No pending posts.</p>
{% endfor %}

<h2 class="text-xl font-semibold text-gray-800 mb-4 mt-8">Flagged Posts ({{ flagged_posts_with_reports|length }})</h2>
{% for item in flagged_posts_with_reports %}
  {% set p = item.post %}
  <div class="card">
    <div class="text-sm text-gray-600 mb-1">
      {{ p.category }}
    </div>

    <div class="text-sm text-gray-500 mb-3">
      <span data-timestamp="{{ p.submitted_at.isoformat() }}" data-time-format="full"></span>
    </div>

    <p class="text-gray-800 mb-3">{{ p.content }}</p>

    <div class="bg-red-50 border border-red-200 rounded-lg p-3 mb-3">
      <h4 class="text-sm font-semibold text-red-800 mb-2">Report Reasons:</h4>
      {% for report in item.reports %}
        <div class="text-sm text-red-700 mb-1">
          <span class="font-medium">â€¢</span> {{ report.reason }}
          <span class="text-gray-500 text-xs ml-2">
            (<span data-timestamp="{{ report.reported_at.isoformat() }}" data-time-format="short"></span>)
          </span>
        </div>
      {% endfor %}
    </div>

    <div class="flex space-x-3">
      <form method="POST" action="{{ url_for('routes.approve_flagged_post', pid=p.id) }}" style="display: inline;">
        <button type="submit" class="btn btn-success" style="padding: 6px 12px; font-size: 14px;">
          Approve & Clear Reports
        </button>
      </form>
      <form method="POST" action="{{ url_for('routes.decline_flagged_post', pid=p.id) }}" style="display: inline;">
        <button type="submit" class="btn btn-danger" style="padding: 6px 12px; font-size: 14px;">
          Decline
        </button>
      </form>
    </div>
  </div>
{% else %}
  <p class="text-gray-500">No flagged posts.</p>
{% endfor %}
{% endblock %}